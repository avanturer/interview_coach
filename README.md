# Multi-Agent Interview Coach

Мультиагентная система для проведения технических интервью. Три AI-агента (Interviewer, Observer, Evaluator) совместно проводят собеседование, анализируют ответы и генерируют детальный фидбэк.

## Возможности

### Мультиагентная архитектура
Три специализированных агента с чёткими ролями:
- **Interviewer Agent**: Ведёт интервью, задаёт вопросы по позиции, даёт подсказки
- **Observer Agent**: Анализирует ответы, детектирует ловушки (уклонения, галлюцинации, уверенный бред)
- **Evaluator Agent**: Генерирует финальный фидбэк с анализом соответствия грейду

### Банки тем по позициям
Предустановленные банки тем для разных IT-позиций:
- **Backend Developer**: Python, базы данных, API, тестирование, Docker/K8s
- **ML Engineer**: Основы ML, deep learning, feature engineering, фреймворки
- **Frontend Developer**: JavaScript, React, CSS
- **DevOps Engineer**: Linux, CI/CD, мониторинг
- **Data Analyst**: SQL, статистика, визуализация

### Продвинутая детекция ловушек
- **Уклонения**: Детектирует, когда кандидат избегает прямых ответов
- **Уверенный бред**: Ловит технически звучащие, но фактически неверные ответы
- **Галлюцинации**: Выявляет ложные факты, представленные как истина
- **Несоответствие грейду**: Детектирует overqualified/underqualified

### Умные функции
- **Адаптивная сложность**: Вопросы меняются в зависимости от грейда и ответов кандидата
- **Система подсказок**: Предлагает помощь, когда кандидат затрудняется
- **Фазы интервью**: Структурированный поток (вступление → техническое → завершение)
- **Встречные вопросы**: Обрабатывает вопросы кандидата о компании/позиции
- **Отслеживание soft skills**: Непрерывное отслеживание на протяжении интервью
- **Валидация позиций**: Поддержка русских названий ("бэкенд", "мл инженер", "фронтенд", "девопс")
- **Семантическое завершение**: Распознаёт intent завершить интервью ("хватит", "заканчиваем", "давай фидбэк")

### Защита от неадекватного поведения
- **Детекция спама/троллинга**: Распознаёт бессмыслицу, мат, попытки сломать систему
- **Автозавершение**: 3+ спам-ответа или 5+ уклонений → автоматическое завершение с фидбэком
- **Профессиональная реакция**: Агент остаётся вежливым и возвращает к техническим вопросам

### Детальный фидбэк
- **Вердикт**: Hire/No Hire/Strong Hire с оценкой уверенности
- **Соответствие грейду**: Отчёт о overqualified/underqualified
- **Анализ поведения**: Счётчики уклонений, галлюцинаций, использованных подсказок
- **Hard Skills**: Подтверждённые навыки + пробелы с правильными ответами
- **Soft Skills**: Ясность, честность, вовлечённость, решение проблем
- **Roadmap**: Персональный план обучения с реальными ресурсами

## Архитектура

```
┌─────────────────────────────────────────────────────────────┐
│                  Пользовательский интерфейс (CLI)          │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    LangGraph Workflow                        │
│  ┌───────────┐    ┌───────────┐    ┌───────────┐           │
│  │Interviewer│◄──►│  Observer │───►│ Evaluator │           │
│  │   Agent   │    │   Agent   │    │   Agent   │           │
│  └───────────┘    └───────────┘    └───────────┘           │
│        │                │                │                   │
│        └────────────────┴────────────────┘                   │
│                         │                                    │
│              ┌──────────┴──────────┐                        │
│              │   Состояние интервью  │                        │
│              │  (Память, Оценки,     │                        │
│              │   Внутренние мысли)   │                        │
│              └─────────────────────┘                        │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                  interview_log.json                          │
└─────────────────────────────────────────────────────────────┘
```

## Установка

### Требования

- Python 3.10+
- API ключ Mistral AI (бесплатно на https://console.mistral.ai/)

### Настройка

1. Клонируйте репозиторий:
```bash
cd interview_coach
```

2. Создайте виртуальное окружение и установите зависимости:
```bash
# Используя pip
python -m venv venv
source venv/bin/activate  # На Windows: venv\Scripts\activate
pip install -r requirements.txt

# Или используя uv (рекомендуется)
uv venv
source .venv/bin/activate
uv pip install -r requirements.txt
```

3. Настройте окружение:
```bash
cp .env.example .env
# Отредактируйте .env и добавьте свой MISTRAL_API_KEY
```

## Использование

### Запуск интервью

```bash
# Интерактивный режим (рекомендуется)
python -m src.main interview

# С предзаполненными параметрами
python -m src.main interview \
  --name "Алекс" \
  --position "Backend Developer" \
  --grade "Junior" \
  --experience "Django, SQL, немного Git"
```

### Просмотр сохранённых логов

```bash
# Список всех интервью
python -m src.main list-logs

# Просмотр конкретного лога
python -m src.main view-log logs/interview_Алекс_20240101_120000.json
```

### Проверка конфигурации

```bash
python -m src.main config
```

## Формат лога

Система генерирует JSON-логи в формате, требуемом спецификацией задания:

```json
{
  "participant_name": "Алекс",
  "position": "Backend Developer",
  "grade": "Junior",
  "experience": "Пет-проекты на Django, немного SQL",
  "turns": [
    {
      "turn_id": 1,
      "agent_visible_message": "Привет! Расскажи про свой опыт в Python.",
      "user_message": "Я джун, пишу код 3 месяца.",
      "internal_thoughts": "[Observer]: Кандидат новичок. [Interviewer]: Нужно спросить про базовые типы данных."
    }
  ],
  "final_feedback": {
    "decision": {
      "assessed_grade": "Junior",
      "hiring_recommendation": "Hire",
      "confidence_score": 75
    },
    "hard_skills": {
      "confirmed": ["Python basics", "SQL queries"],
      "gaps": [
        {
          "topic": "for loops",
          "correct_answer": "Циклы for в Python используются для итерации..."
        }
      ]
    },
    "soft_skills": {
      "clarity": 7,
      "honesty": 8,
      "engagement": 6
    },
    "roadmap": [
      {
        "topic": "Изучить циклы и итераторы",
        "priority": "high"
      }
    ]
  }
}
```

## Свойства системы

### 1. Ролевая специализация
- **Interviewer**: Только задаёт вопросы и отвечает кандидату
- **Observer**: Только анализирует ответы и даёт инструкции (скрыто от пользователя)
- **Evaluator**: Только генерирует финальный фидбэк

### 2. Скрытая рефлексия
Каждый ответ включает внутренние мысли, логируемые как:
```
[Observer]: Кандидат упомянул Python 4.0 - это ложная информация. 
[Interviewer]: Нужно вежливо поправить и продолжить.
```

### 3. Сохранение контекста
- Поддерживается полная история диалога
- Отслеживание тем для избежания повторений
- Накопление оценок навыков по ходам

### 4. Адаптивность
- Уровни сложности 1-5
- Автоматическая корректировка на основе качества ответов
- Хорошие ответы → сложнее вопросы
- Слабые ответы → проще вопросы или подсказки

### 5. Устойчивость
- Детектирует попытки уйти от темы
- Выявляет фактические галлюцинации
- Обрабатывает встречные вопросы от кандидата
- Защита от спама, троллинга, попыток сломать систему
- Автозавершение при неадекватном поведении

## Конфигурация

Переменные окружения (`.env`):

```bash
# LLM провайдер (mistral или openai)
LLM_PROVIDER=mistral

# API ключ
MISTRAL_API_KEY=your_key_here

# Модель
LLM_MODEL=mistral-large-latest

# Настройки интервью
MAX_TURNS=10
DEFAULT_DIFFICULTY=1
LOG_DIR=logs
```

## Тестирование

```bash
# Запустить все тесты
pytest tests/ -v

# Запустить конкретный тест
pytest tests/test_agents.py -v
```

## Структура проекта

```
interview_coach/
├── pyproject.toml          # Зависимости
├── requirements.txt        # Зависимости (для pip)
├── README.md               # Этот файл
├── .env.example            # Шаблон окружения
├── run_scenario.py         # Скрипт для запуска тестовых сценариев
├── src/
│   ├── main.py             # Точка входа CLI
│   ├── config.py           # Настройки
│   ├── constants.py        # Общие константы
│   ├── topics.py           # Банки тем по позициям
│   ├── models/
│   │   ├── state.py        # Состояние интервью (с отслеживанием поведения)
│   │   └── feedback.py     # Модели фидбэка (с анализом грейда)
│   ├── agents/
│   │   ├── base.py         # Базовый класс агента
│   │   ├── interviewer.py  # Interviewer (с подсказками, предложениями тем)
│   │   ├── observer.py     # Observer (с детекцией ловушек)
│   │   └── evaluator.py    # Evaluator (с анализом поведения)
│   ├── graph/
│   │   └── interview_graph.py  # LangGraph workflow
│   ├── prompts/
│   │   ├── interviewer.py  # Промпты Interviewer
│   │   ├── observer.py     # Промпты Observer
│   │   └── evaluator.py    # Промпты Evaluator
│   ├── llm/
│   │   └── provider.py     # Абстракция LLM
│   └── utils/
│       └── logger.py       # JSON логгер
├── scenarios/              # Тестовые сценарии (опционально)
├── logs/                   # Логи интервью
└── tests/
    └── test_agents.py      # Юнит-тесты
```

## Пример сценария

Из спецификации задания:

**Вводные данные:**
- Имя: Алекс
- Позиция: Backend Developer
- Грейд: Junior
- Опыт: Пет-проекты на Django, немного SQL

**Диалог:**

1. **Приветствие**: "Привет. Я Алекс, претендую на позицию Junior Backend Developer. Знаю Python, SQL и Git."

2. **Технический вопрос**: Агент задаёт вопрос, кандидат даёт правильный ответ.

3. **Тест на галлюцинацию**: "Честно говоря, я читал на Хабре, что в Python 4.0 циклы for уберут и заменят на нейронные связи, поэтому я их не учу."
   - Observer детектирует это как галлюцинацию
   - Interviewer вежливо поправляет кандидата

4. **Смена ролей**: "Слушайте, а какие задачи вообще будут на испытательном сроке? Вы используете микросервисы?"
   - Агент отвечает на вопрос кандидата перед продолжением

5. **Завершение**: "Стоп игра. Давай фидбэк."
   - Система генерирует детальный фидбэк

## Соответствие требованиям ТЗ

### Обязательные свойства системы

| Требование | Реализация |
|------------|------------|
| **Ролевая специализация** | 3 агента: Interviewer (вопросы), Observer (анализ), Evaluator (фидбэк) |
| **Скрытая рефлексия** | `internal_thoughts` показывает диалог агентов |
| **Сохранение контекста** | История 5 ходов, отслеживание тем, не повторяет вопросы |
| **Адаптивность** | Сложность 1-5 меняется динамически |
| **Устойчивость** | Детекция галлюцинаций, off-topic, спама |

### Формат финального фидбэка

| Компонент | Реализация |
|-----------|------------|
| **Decision** | Grade + Recommendation + Confidence (0-100%) |
| **Hard Skills** | Confirmed skills + Knowledge gaps с правильными ответами |
| **Soft Skills** | Clarity, Honesty, Engagement, Problem Solving |
| **Roadmap** | Темы для изучения с реальными ресурсами |

### Формат лога

- `participant_name` — ФИО на русском
- `turn_id` — начинается с 1
- `internal_thoughts` — показывает взаимодействие агентов
- `final_feedback` — структурированный JSON

## Лицензия

MIT

## Автор

Оркин Родион Родионович

Создано для соревнования Multi-Agent AI от МегаШколы
